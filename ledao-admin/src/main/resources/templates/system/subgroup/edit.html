<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
    <th:block th:include="include :: header('修改我的小组')" />
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight ibox-content">
        <form class="form-horizontal m" id="form-subgroup-edit" th:object="${sysSubgroup}">
            <input name="subgroupId" th:field="*{subgroupId}" type="hidden">
            <div class="form-group">
                <label class="col-sm-3 control-label">小组名称：</label>
                <div class="col-sm-8">
                    <input name="subgroupName" th:field="*{subgroupName}" class="form-control" type="text">
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-3 control-label">小组成员：</label>
                <div class="col-sm-8">
                    <input name="subgroupUserId" th:field="*{subgroupUserId}" id="subgroupUserId" class="form-control" type="hidden">
                    <input name="subgroupUserName" th:field="*{subgroupUserName}" id="subgroupUserName" class="form-control" type="text" onclick="selectUserTree()">
                </div>
            </div>
        </form>
    </div>
    <th:block th:include="include :: footer" />
    <script type="text/javascript">
        var prefix = ctx + "system/subgroup";
        $("#form-subgroup-edit").validate({
            focusCleanup: true
        });

        function submitHandler() {
            if ($.validate.form()) {
                $.operate.save(prefix + "/edit", $('#form-subgroup-edit').serialize());
            }
        }
        //人员树形选择器
        function selectUserTree() {
            var options = {
                title: '人员选择',
                width: "750",
                url: ctx + "system/user/selectUserTreeList?selectedUserIds=" + $("#subgroupUserId").val() + "&selectedUserNames=" + $("#subgroupUserName").val() + "&multiSelectFlag=true",
                callBack: doSelect
            };
            $.modal.openOptions(options);
        }

        function doSelect(index, layero) {

            var body = layer.getChildFrame('body', index);

            var userIds = "";
            var userNames = "";
            body.find("#multiselect_to option").each(function () {  //遍历所有option
                var val = $(this).val();   //获取option值
                var txt = $(this).text();  //获取option的文本内容
                if (val != '' && txt != '') {
                    userIds = userIds + val + ",";
                    userNames = userNames + txt + ",";
                }
            });

            userIds = userIds.substring(0, userIds.length - 1);
            userNames = userNames.substring(0, userNames.length - 1);

            $("#subgroupUserId").val(userIds);
            $("#subgroupUserName").val(userNames);
            layer.close(index);
        }
    </script>
</body>
</html>