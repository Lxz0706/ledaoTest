<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
  <th:block th:include="include :: header('新增档案')" />
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
  <form class="form-horizontal m" id="form-applyIn-editDocumentModal" enctype="multipart/form-data">
    <input name="applyId" id="applyId" th:value="*{applyId}" type="hidden">
    <input name="documentTypeVal" id="documentTypeVal" th:value="*{documentTypeVal}" type="hidden">
    <input name="documentType" id="documentType" th:value="*{documentType}" type="hidden">
    <input name="applyType" id="applyType" th:value="*{applyType}" type="hidden">
    <input name="applyTypeUnDone" id="applyTypeUnDone" th:value="*{applyTypeUnDone}" type="hidden">
    <!--<div class="form-group" id="assetPag" style="display: none">
      <label class="col-sm-3 control-label is-required">项目名称：</label>
      <div class="col-sm-8">
        <input name="projectName" class="form-control required" type="text">
      </div>
    </div>-->
    <div class="form-group" id="assetNumber" style="display: none">
      <label class="col-sm-3 control-label is-required">资产编号：</label>
      <div class="col-sm-8">
        <input name="assetNumber" class="form-control required" type="text">
      </div>
    </div>
    <div class="form-group" id="contractNo" style="display: none">
      <label class="col-sm-3 control-label">合同编号：</label>
      <div class="col-sm-8">
          <input name="contractNo" class="form-control" type="text">
      </div>
    </div>
    <div class="form-group" id="dailyDocumentType" style="display: none">
      <label class="col-sm-3 control-label is-required">种类：</label>
      <div class="col-sm-8">
        <select id="dailyDocumentTypeSelect" name="dailyDocumentType" th:with="type=${@dict.getType('daily_document_type')}"
                data-none-selected-text="请选择" class="form-control m-b required" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
        <select id="dailyDocumentTypeSelectContract" name="dailyDocumentType" th:with="type=${@dict.getType('contract_document_type')}"
                data-none-selected-text="请选择" class="form-control m-b required" onchange="changeFileTypeVal(this.value)">
          <option value="">请选择数据</option>
          <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-3 control-label is-required">文件名称：</label>
      <div class="col-sm-8">
        <textarea name="fileName" class="form-control required"></textarea>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-3 control-label is-required">附件类型：</label>
      <div class="col-sm-8">
        <select id="fileType" name="fileType" th:with="type=${@dict.getType('document_file_type')}"
                data-none-selected-text="请选择" class="form-control m-b required" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div class="form-group" id="fileScanTypeFormGroup" style="display: none">
      <label class="col-sm-3 control-label">扫描件类型：</label>
      <div class="col-sm-8">
        <select id="fileScanType" name="fileScanType" th:with="type=${@dict.getType('document_scan_type')}"
                data-none-selected-text="请选择" class="form-control m-b">
            <option value="">请选择数据</option>
          <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-3 control-label is-required">份数：</label>
      <div class="col-sm-8">
        <input name="counts" class="form-control required" type="number">
      </div>
    </div>
    <div class="form-group">
      <label class="col-sm-3 control-label is-required">页数/时长：</label>
      <div class="col-sm-8">
        <input name="pages" class="form-control required" type="number">
      </div>
    </div>
    <div id="documentStatu" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">档案状态：</label>
      <div class="col-sm-8">
        <select id="documentStatuSelect" name="documentStatu" th:with="type=${@dict.getType('document_in_status')}"
                data-none-selected-text="请选择" class="form-control m-b" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
          <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div id="cabinetNo" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">柜号：</label>
      <div class="col-sm-8">
        <input name="cabinetNo" class="form-control" type="text">
      </div>
    </div>
    <div id="bagNo" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">档案袋编号：</label>
      <div class="col-sm-8">
        <input name="bagNo" class="form-control" type="text">
      </div>
    </div>
    <div id="documentGetType" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">档案类型：</label>
      <div class="col-sm-8">
        <select id="documentGetTypeSelect" name="documentGetType" th:with="type=${@dict.getType('busi_document_type')}"
                data-none-selected-text="请选择" class="form-control m-b" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div id="fileGetType" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">文件类型：</label>
      <div class="col-sm-8">
        <select id="fileGetTypeSelect" name="fileGetType" th:with="type=${@dict.getType('document_in_type')}"
                data-none-selected-text="请选择" class="form-control m-b" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
    <div id="documentLevel" class="form-group" style="display: none">
      <label class="col-sm-3 control-label">档案级别：</label>
      <div class="col-sm-8">
        <select id="documentLevelSelect" name="documentLevel" th:with="type=${@dict.getType('document_level')}"
                data-none-selected-text="请选择" class="form-control m-b" onchange="changeFileTypeVal(this.value)">
            <option value="">请选择数据</option>
            <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                  th:value="${dict.dictValue}"></option>
        </select>
      </div>
    </div>
  </form>
</div>
<th:block th:include="include :: footer" />
<script type="text/javascript" th:inline="javascript">
  var prefix = ctx + "applyIn"
  var roles = [[${@permission.getPrincipalProperty('roles')}]];
  var loginName = [[${@permission.getPrincipalProperty('loginName')}]];
  var documentTypeDictDatas = [[${@dict.getType('sys_document_busi_type')}]];
  // 用于 [修改] 入库申请 判断档案类别
  var documentTypeId = document.getElementById('documentTypeVal').value;
  // 用于 [新增] 入库申请 判断档案类别
  var documentType = document.getElementById('documentType').value;
  // var apag = document.getElementById("assetPag");
  var aNumber = document.getElementById("assetNumber");
  var cNo = document.getElementById("contractNo");
  var dailyDocumentType = document.getElementById("dailyDocumentType")
  var applyType = document.getElementById("applyType").value
  for(var i = 0; i < roles.length; i++) {
    if(applyType == "0" || applyType == "") {
      $("#documentStatu").hide();
      $("#cabinetNo").hide();
      $("#bagNo").hide();
      $("#documentGetType").hide();
      $("#fileGetType").hide();
      $("#documentLevel").hide();
    } else {
      if(roles[i].roleKey == "documentAdmin" || "admin" == loginName) {
        $("#documentStatu").show();
        $("#cabinetNo").show();
        $("#bagNo").show();
        $("#documentGetType").show();
        $("#fileGetType").show();
        $("#documentLevel").show();
      }
    }
  }

  if(documentTypeId == "0" || documentType == "0") {
      // apag.style.display = "block"
      aNumber.style.display = "block"
      cNo.style.display = "block"
      dailyDocumentType.style.display = "none"
  } else {
      // apag.style.display = "none"
      aNumber.style.display = "none"
      cNo.style.display = "none"
      dailyDocumentType.style.display = "block"
  }

  if(documentType == 1 || documentTypeId == 1) {
    $('#dailyDocumentTypeSelectContract').hide()
  } else if(documentType == 2 || documentTypeId == 2) {
    $('#dailyDocumentTypeSelect').hide()
  }

  $("#form-documentFile-add").validate({
    focusCleanup: true
  });

  function submitHandler() {
    if ($.validate.form()) {
      // 处理自己的业务
      var form = document.getElementById("form-applyIn-editDocumentModal");
      var formdata = new FormData(form);
      formdata.append("files", $('input[type=file]')[0]);
      $.ajax({
        url: ctx + 'documentFile/add',
        data: formdata,
        type: "post",
        processData: false,
        contentType: false,
        success: function(result) {
            $.operate.successCallback(result);
        }
      })
    }
  }

  function changeFileTypeVal(val) {
    var fileScanTypeFormGroup = document.getElementById("fileScanTypeFormGroup")
    if(val === '2') {
      fileScanTypeFormGroup.style.display = "block"
    } else {
      fileScanTypeFormGroup.style.display = "none"
    }
  }
</script>
</body>
</html>